---
title: "CWLã®ä½œæˆç’°å¢ƒã‚’VScodeã®ï½¢Dev Containersï½£ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã™ã‚‹ (2)"
emoji: "ðŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [CWL]
published: false
---
Author: Sora Yonezawa
---

&nbsp;

:::success
ä»Šå›žã®è¨˜äº‹ã§ä½¿ç”¨ã—ãŸCWLã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠã„ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã¯ä»¥ä¸‹ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï½¡
__[togotv_cwl_for_remote_container](https://github.com/yonezawa-sora/togotv_cwl_for_remote_container)__
:::

:::danger
ã“ã®èµ¤ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¾Œã»ã©ä¿®æ­£ã™ã‚‹ç‚¹ã‚’ãƒ¡ãƒ¢ã—ã¦ã„ã¾ã™
:::

&nbsp;

# ã¯ã˜ã‚ã«

:::info
__æœ¬è¨˜äº‹ã®å¯¾è±¡ã¨ãªã‚‹æ–¹__

â–  ç’°å¢ƒæ§‹ç¯‰ãŒã§ããŸã®ã§ã‚‚ã£ã¨CWLã‚’ã‚¬ã‚·ã‚¬ã‚·æ›¸ã„ã¦ã„ããŸã„äºº
â–  CWLã®æ–‡æ³•ã‚’å®Ÿéš›ã«æ›¸ã„ã¦ã¿ã¦å­¦ã³ãŸã„äºº

(1)ã®è¨˜äº‹ã‚’è¦‹ã¦ã„ãŸã ã„ãŸã‚ã¨ï½¤æ›´ã«CWLã‚’å‹‰å¼·ã—ãŸã„ã¨ã„ã†æ–¹å‘ã‘ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ï½¡
:::

ä»¥å‰ã®è¨˜äº‹ã§ã¯ï½¤ç’°å¢ƒæ§‹ç¯‰ã‚„zatsu-cwl-generatorã®ä½¿ã„æ–¹ã‚’ã”ç´¹ä»‹ã—ã¾ã—ãŸï½¡
ã“ã®è¨˜äº‹ã§ã¯ï½¤ä»¥ä¸‹ã®2ç‚¹ã‚’ã”ç´¹ä»‹ã—ã¾ã™ï½¡
__(1) zatsu-cwl-generatorã§ç”Ÿæˆã•ã‚ŒãŸcwlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã—ãªãŒã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿéš›ã«è¨˜è¿°ã™ã‚‹__
__(2) ãƒã‚¤ã‚ªã‚¤ãƒ³ãƒ•ã‚©ãƒžãƒ†ã‚£ã‚¯ã‚¹ã®è§£æžã«é–¢ã‚ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨˜è¿°ã™ã‚‹__

CWLã®æ–‡æ³•ã‚‚å°‘ã—ãšã¤ç´¹ä»‹ã—ãªãŒã‚‰ï½¤æ§˜ã€…ãªã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆã—ã¤ã¤ï½¤__ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼__ ã‚’ä½œã£ã¦ã„ãã¾ã™ï½¡

&nbsp;

# ã€Case1ã€‘grepã‚³ãƒžãƒ³ãƒ‰ã¨wcã‚³ãƒžãƒ³ãƒ‰ã‚’CWLåŒ–ã™ã‚‹


åˆã‚ã«(1)ã®è¨˜äº‹ã§ä½œã£ãŸgrepã‚³ãƒžãƒ³ãƒ‰ã®cwlãƒ•ã‚¡ã‚¤ãƒ«ã«åŠ ãˆï½¤wcã‚³ãƒžãƒ³ãƒ‰ã‚’ä½¿ã£ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’CWLã«ã‚ˆã£ã¦è¨˜è¿°ã™ã‚‹ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ï½¡

å®Ÿè¡Œã™ã‚‹ã®ã¯ï½¤`grep one mock.txt > grep_out.txt` ã¨ `wc -l grep_out.txt > wc_out.txt` ã®2ã¤ã§ã™ï½¡ 
ã“ã®2ã¤ã¯ï½¤æ—¥æœ¬èªžãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ(CWL Start Guide JP)ã§ã‚‚èª¬æ˜Žã•ã‚Œã¦ã„ã‚‹ä¾‹ã«ãªã‚Šã¾ã™ï½¡

```bash=
grep one mock.txt > grep_out.txt
wc -l grep_out.txt > wc_out.txt
```

#### å‚è€ƒï¼š[CWL Start Guide JP: CWL ã§æ›¸ã„ã¦ã¿ã‚‹: ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«](https://github.com/pitagora-network/pitagora-cwl/wiki/CWL-Start-Guide-JP#cwl-%E3%81%A7%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%84%E3%83%BC%E3%83%AB)

&nbsp;

æ¬¡ã«ï½¤å®Ÿéš›ã«CWLãƒ•ã‚¡ã‚¤ãƒ«ã®è¨˜è¿°ã‚’è¡Œã£ã¦ã„ãã¾ã™ï½¡ä»Šå›žä¸»å½¹ã¨ãªã‚‹ã‚³ãƒžãƒ³ãƒ‰ã¯ ï½¢grepï½£ ã¨ï½¢wcï½£ã®2ã¤ã§ã™ï½¡Â ä»Šå›žè¨˜è¿°ã™ã‚‹æµã‚Œã¨ã—ã¦ã¯ä»¥ä¸‹ã®2ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ï½¡
__Step1ï¼šã‚³ãƒžãƒ³ãƒ‰ã®å‡¦ç†ã«é–¢ã™ã‚‹cwlãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã(ä»Šå›žã¯2ã¤)__
__Step2ï¼šãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã‚’è¨˜è¿°ã™ã‚‹cwlãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã__

&nbsp;

CWLãƒ•ã‚¡ã‚¤ãƒ«ã¯è¨˜è¿°ã™ã‚‹å†…å®¹ã‚’ YAMLã‹JSON ã®å½¢å¼ã§è¨˜è¿°ã—ã€ï½¢.cwl ï½£ã¨ã„ã†æ‹¡å¼µå­ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚å®Ÿè¡Œæ™‚ã«ã“ã® CWL ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ã«å…¥åŠ›ã™ã‚‹ã¨ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï½¤ã¨ã„ã†æµã‚Œã«ãªã£ã¦ã„ã¾ã™ï½¡ã¾ãšã¯ã˜ã‚ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€åˆã®å‡¦ç†ã§ã‚ã‚‹ `grep one mock.txt > grepout.txt` ã®å‡¦ç†ã‚’CWLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦è¨˜è¿°ã—ã¦ã„ãã¾ã™ï½¡

:::danger

__è¿½è¨˜ï¼šhttps://view.commonwl.org/workflows?search=__
:::

&nbsp;

## zatsu-cwl-generatorã‚’ä½¿ã£ã¦cwlãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã(Step1)

ãã‚Œã§ã¯å®Ÿéš›ã«æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï½¡ ä»Šå›žã¯ï½¤ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹zatsu-cwl-genratorã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ __å‡ºåŠ›__ ã—ã¦ã¿ã¾ã™ï½¡

å‚è€ƒï¼š[é›‘ã«å§‹ã‚ã‚‹CWLï¼ã‚’ã‚‚ã£ã¨é›‘ã«å§‹ã‚ãŸã„](https://qiita.com/tm_tn/items/2c789c5b3c28e3eb3c9a)

&nbsp;


```yaml=
#!/usr/bin/env cwl-runner
# Generated from: grep one mock.txt > grepout.txt
class: CommandLineTool
cwlVersion: v1.0
baseCommand: grep
arguments:
  - $(inputs.one)
  - $(inputs.mock_txt)
inputs:
  - id: one
    type: Any
    default: one
  - id: mock_txt
    type: File
    doc: please input text file #è¨˜è¼‰ã‚’è¿½åŠ 
    default:
      class: File
      location: mock.txt
outputs:
  - id: all-for-debugging
    type:
      type: array
      items: [File, Directory]
    outputBinding:
      glob: "*"
  - id: out
    type: stdout
stdout: grepout.txt

```

å†åº¦å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï½¡
```bash=
cwltool grep_zatsu.cwl --help
INFO /usr/local/bin/cwltool 3.1.20231016170136
INFO Resolved 'grep_zatsu.cwl' to 'file:///workspaces/togotv_shooting/zatsu_generator/grep_zatsu.cwl'
usage: grep_zatsu.cwl [-h] [--mock_txt MOCK_TXT] [job_order]

positional arguments:
  job_order            Job input json file

options:
  -h, --help           show this help message and exit
  --mock_txt MOCK_TXT  please input text file
```

&nbsp;

å‚è€ƒï¼š[user_guide 2.16 best-practices](https://www.commonwl.org/user_guide/topics/best-practices.html)

:::

&nbsp;

:::warning
ä¸Šè¨˜ã®ã‚ˆã†ã«ã“ã®ã¾ã¾ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚å®Ÿéš›ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï½¡
ã—ã‹ã—ï½¤ã“ã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®éƒ¨åˆ†ã«èµ¤ç·šãŒç¤ºã•ã‚Œã¾ã™ï½¡

```yaml=
inputs:
  - id: one
    type: Any #èµ¤ç·šã§ç¤ºã•ã‚ŒãŸéƒ¨åˆ†
    default: one
```

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã‚‹ã¨ï½¤ `Expecting one of: ['Directory', 'File', 'boolean', 'double', 'float', 'int', 'long', 'null', 'stderr', 'stdout', 'string']`ã¨ã„ã†è¡¨ç¤ºãŒå‡ºã¦ã„ã¾ã™ï½¡
ã“ã“ã§ã¯æ–‡å­—åˆ—ã‚’å…¥åŠ›ã™ã‚‹ã®ã§ï½¤ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã§ãã¾ã™ï½¡

```yaml=
inputs:
  - id: one
    type: string #stringã«å¤‰æ›´
    default: one
```

ãã†ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ¶ˆãˆï½¤`ãƒ¼-help`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï½¡

```bash=
cwltool grep_zatsu.cwl --help
INFO /usr/local/bin/cwltool 3.1.20231016170136
INFO Resolved 'grep_zatsu.cwl' to 'file:///workspaces/togotv_shooting/zatsu_generator/grep_zatsu.cwl'
usage: grep_zatsu.cwl [-h] [--one ONE] [--mock_txt MOCK_TXT] [job_order]

positional arguments:
  job_order            Job input json file

options:
  -h, --help           show this help message and exit
  --one ONE #æ–°ã—ãè¡¨ç¤ºã•ã‚Œã‚‹éƒ¨åˆ†
  --mock_txt MOCK_TXT  please input text file
```

ã“ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§ã¯ï½¤è‡ªåˆ†ãŒã©ã®ã‚ˆã†ã«å®Ÿè¡Œã—ãŸã„ã®ã‹(ã¨ã‚Šã‚ãˆãšå‹•ã‹ã—ã¦ã¿ãŸã„ï½¤zatsu-cwl-genratorã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã—ã£ã‹ã‚Šæ›¸ããŸã„ï½¤ãªã©)ã‚’å®šã‚ã¦ãŠãã“ã¨ã§ï½¤ä¿®æ­£ãŒä¸è¦ã‹ã©ã†ã‹ãªã©ãŒå¤‰ã‚ã£ã¦ãã¾ã™ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ï½¡

zatsu-cwl-generatorã‚„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªåˆ†ã®æ„å›³ã«åˆã‚ã›ã¦ã†ã¾ãæ´»ç”¨ã—ã¦ã„ãã¾ã—ã‚‡ã†!

:::

&nbsp;

### wcã‚³ãƒžãƒ³ãƒ‰ã®CWLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã

åŒæ§˜ã«ï½¤wcã‚³ãƒžãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ãŸCWLãƒ•ã‚¡ã‚¤ãƒ«ã‚’zatsu-cwl-generatorã§å‡ºåŠ›ã—ã¦ã¿ã¾ã™ï½¡

```bash=
zatsu-cwl-generator 'wc -l grep_out.txt > wc_out.txt' > wc_zatsu.cwl
```

å‡ºåŠ›ã•ã‚ŒãŸçµæžœãŒä»¥ä¸‹ã«ãªã‚Šã¾ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: wc -l grep_out.txt > wc_out.txt
class: CommandLineTool
cwlVersion: v1.0
baseCommand: wc
arguments:
  - -l
  - $(inputs.l)
inputs:
  - id: l
    type: File
    default:
      class: File
      location: grep_out.txt
outputs:
  - id: all-for-debugging
    type:
      type: array
      items: [File, Directory]
    outputBinding:
      glob: "*"
  - id: out
    type: stdout
stdout: wc_out.txt
```

&nbsp;

å…ˆç¨‹ã¨åŒæ§˜ã«ï½¤ã¾ãš`--validate` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦è©•ä¾¡ã—ã¦ã¿ã¾ã™ï½¡

```bash=
cwltool --validate wc_zatsu.cwl
INFO /usr/local/bin/cwltool 3.1.20231016170136
INFO Resolved 'wc_zatsu.cwl' to 'file:///workspaces/togotv_shooting/zatsu_generator/wc_zatsu.cwl'
wc_zatsu.cwl:14:7: Warning: Field 'location' contains undefined reference to
                   'file:///workspaces/togotv_shooting/zatsu_generator/grep_out.txt'
WARNING wc_zatsu.cwl:14:7: Warning: Field 'location' contains undefined reference to
                   'file:///workspaces/togotv_shooting/zatsu_generator/grep_out.txt'
wc_zatsu.cwl is valid CWL.
```

è­¦å‘Šã¯å‡ºã¾ã—ãŸãŒï½¤åŸºæœ¬çš„ãªéƒ¨åˆ†ã¯å¤§ä¸ˆå¤«ãªã‚ˆã†ã§ã™ï½¡
å°‘ã—ä¿®æ­£ã—ã¦ï½¤ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã„ã¦ã¿ã¾ã—ãŸï½¡

```bash=
#!/usr/bin/env cwl-runner
# Generated from: wc -l grep_out.txt > wc_out.txt
class: CommandLineTool
cwlVersion: v1.0
baseCommand: wc
arguments:
  - -l
  - $(inputs.grep_file)
inputs:
  - id: grep_file #ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«åå‰ã‚’å¤‰æ›´
    type: File
    default:
      class: File #locationãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¸€æ—¦å‰Šé™¤
outputs:
  - id: all-for-debugging
    type:
      type: array
      items: [File, Directory]
    outputBinding:
      glob: "*"
  - id: out
    type: stdout
stdout: wc_out.txt

```

ã‚‚ã†ä¸€åº¦`--validate`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ç¢ºèªã—ã¦ã¿ã¾ã™ï½¡

```bash=
cwltool --validate wc_zatsu.cwl
INFO /usr/local/bin/cwltool 3.1.20231016170136
INFO Resolved 'wc_zatsu.cwl' to 'file:///workspaces/togotv_shooting/zatsu_generator/wc_zatsu.cwl'
wc_zatsu.cwl is valid CWL.
```

&nbsp;

å¤§ä¸ˆå¤«ãªã‚ˆã†ãªã®ã§ï½¤æ¬¡ã«å®Ÿéš›ã«å®Ÿè¡Œã—ã¦ã¿ã¾ã™ï½¡

```bash=
cwltool wc_zatsu.cwl
INFO /usr/local/bin/cwltool 3.1.20231016170136
INFO Resolved 'wc_zatsu.cwl' to 'file:///workspaces/togotv_shooting/zatsu_generator/wc_zatsu.cwl'
ERROR Input object failed validation:
Anonymous file object must have 'contents' and 'basename' fields.
```

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï½¡ã©ã†ã‚„ã‚‰`input`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®éƒ¨åˆ†ã§ã†ã¾ãã„ã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ï½¡
`contents` ã¨ `basename` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ï½¡

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: wc -l grep_out.txt > wc_out.txt
class: CommandLineTool
cwlVersion: v1.0
baseCommand: wc
arguments:
  - -l
  - $(inputs.grep_file)
inputs:
  - id: grep_file
    type: File
    default:
      class: File
      basename: "grepout.txt"
      contents: "This is a text file."
outputs:
  - id: all-for-debugging
    type:
      type: array
      items: [File, Directory]
    outputBinding:
      glob: "*"
  - id: out
    type: stdout
stdout: wc_out.txt
```

å†åº¦å®Ÿè¡Œã—ã¦çµæžœã‚’è¦‹ã¦ã¿ãŸæ‰€ï½¤ã‚«ã‚¦ãƒ³ãƒˆãŒæœ¬æ¥ã¯4ãªã®ã§ã™ãŒï½¤0ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã—ãŸï½¡
ãã“ã§ï½¤pathã‚’æ˜Žç¤ºã™ã‚Œã°è‰¯ã„ã®ã‹ãªã¨è€ƒãˆï½¤ä»¥ä¸‹ã®ã‚ˆã†ã«`path`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¦å†ä¿®æ­£ã—ã¾ã—ãŸï½¡

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: wc -l grep_out.txt > wc_out.txt
class: CommandLineTool
cwlVersion: v1.0
baseCommand: wc
arguments:
  - -l
  - $(inputs.grep_file)
inputs:
  - id: grep_file
    type: File
    default:
      class: File
      basename: "grepout.txt"
      contents: "This is a text file."
      path: ./grepout.txt # pathãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
outputs:
  - id: all-for-debugging
    type:
      type: array
      items: [File, Directory]
    outputBinding:
      glob: "*"
  - id: out
    type: stdout
stdout: wc_out.txt
```

çµæžœã‚’è¦‹ã¦ã¿ã‚‹ã¨ï½¤4ã¨ã—ã£ã‹ã‚Šã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã¾ã—ãŸï½¡

```text=
4 /tmp/o8n3tzc8/stg195a993d-1cac-4ba9-bfd2-4266ebad333f/grepout.txt
```

ã“ã®ã‚ˆã†ã«ï½¤ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„çµæžœã‚’è¦‹ã‚‹ãªã©ã—ã¦é©åˆ‡ãªãƒ•ã‚¡ã‚¤ãƒ«ã«é€æ¬¡ä¿®æ­£ã™ã‚‹ã“ã¨ãŒå¤§äº‹ã§ã™ï½¡

&nbsp;

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è¨˜è¿°ã‚’è¡Œã†(Step2)

ãã‚Œã§ã¯ï½¤ã“ã®2ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿéš›ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦è¨˜è¿°ã—ã¦ã„ãã¾ã™ï½¡
`grep-and-count.cwl`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ï½¡ 

ä»¥ä¸‹ã§ã¯ï½¤ã“ã‚Œã¾ã§ã¨ã¯ç•°ãªã‚‹éƒ¨åˆ†ã‚’ä¸­å¿ƒã«è§£èª¬ã—ã¾ã™ï½¡

`class`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šã“ã“ã«ã¯ã“ã‚Œã¾ã§ã¨é•ã„ï½¤`Workflow`ã¨è¨˜è¿°ã—ã¾ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
cwlVersion: v1.0
class: Workflow
```
&nbsp;

ç¶šã„ã¦`inputs`, `outputs`, ãã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ‰‹é †ã‚’è¨˜è¿°ã™ã‚‹`steps` ã«ã¤ã„ã¦æ³¨ç›®ã—ã¾ã™ï½¡ 

`inputs`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šã“ã“ã§ã¯ï½¤ __ï½¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï½£__ ã¨ã—ã¦å¿…è¦ãªå…¥åŠ›ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦è¨˜è¿°ã—ã¾ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
cwlVersion: v1.0
class: Workflow
inputs:
  grep_pattern:
    type: string
  target_file:
    type: File
```
ä»Šå›žã¯ï½¤æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚ã‚‹ï½¢grepï½£ã‚³ãƒžãƒ³ãƒ‰ã®æŠœãå‡ºã™ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ï½¤å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®2ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ï½¤ãã‚Œãžã‚Œã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒ—ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ï½¡

&nbsp;

`outputs`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šã“ã“ã§ã¯ï½¤ï½¢wcï½£ã‚³ãƒžãƒ³ãƒ‰å‡ºåŠ›ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨˜è¿°ã—ã¾ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
cwlVersion: v1.0
class: Workflow
inputs:
  grep_pattern:
    type: string
  target_file:
    type: File 
outputs:
  counts:
    type: File
    outputSource: 2_wc/out
```
`outputSource` ã¯ï½¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®å‡ºåŠ›ã‚’æ˜Žç¤ºçš„ã«æŒ‡å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚ã‚Šï½¤ç‰¹å®šã®ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®å‡ºåŠ›ã¨ã—ã¦ãƒžãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ï½¡

&nbsp;

`steps`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šã“ã“ã§ã¯ï½¤å…·ä½“çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ‰‹é †ã‚’è¨˜è¿°ã—ã¾ã™ï½¡ ãã‚Œãžã‚Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆï½¤ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’"in"ï½¤"out"ã¨ã—ã¦è¨˜è¿°ã—ã¾ã™ï½¡ 
`run`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã¯å…ˆç¨‹ä½œæˆã—ãŸCommandLinetoolã®å‡¦ç†ã‚’è¨˜è¿°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜è¿°ã—ã¦ãŠãã¾ã™ï½¡ 
ãªãŠï½¤`out`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã¯ï½¤ãƒªã‚¹ãƒˆå½¢å¼(\[ \] ã§å›²ã‚€)ã§æ›¸ãã“ã¨ã§ï½¤è¤‡æ•°ã®å‡ºåŠ›ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ï½¡ 
å®Ÿéš›ã«æ›¸ã„ã¦ã¿ãŸã®ãŒä»¥ä¸‹ã«ãªã‚Šã¾ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
cwlVersion: v1.0
class: Workflow
inputs:
  grep_pattern:
    type: string
  target_file:
    type: File
outputs:
  counts:
    type: File
    outputSource: 2_wc/out
steps:
  1_grep:
    run: grep_zatsu.cwl
    in:
      one: grep_pattern
      mock_txt: target_file
    out: [out]
  2_wc:
    run: wc_zatsu.cwl
    in:
      grep_file: 1_grep/out
    out: [out] 
```

&nbsp;

### å®Ÿéš›ã«å®Ÿè¡Œã—ã¦ã¿ã‚‹

ãã‚Œã§ã¯å®Ÿéš›ã«ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï½¡ 
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œã«ã¯ä»Šå›žï½¤cwl-runnerã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã—ã¾ã™ï½¡

```bash=
cwl-runner grep-and-count.cwl --grep_pattern one --target_file ./grepout.txt
INFO /usr/local/bin/cwl-runner 3.1.20231016170136
INFO Resolved 'grep-and-count.cwl' to 'file:///workspaces/togotv_shooting/zatsu_generator/grep-and-count.cwl'
INFO [workflow ] start
INFO [workflow ] starting step 1_grep
INFO [step 1_grep] start
INFO [job 1_grep] /tmp/51srtkt0$ grep \
    one \
    /tmp/k89vh6vf/stg4d1cfe72-87be-4e6a-8243-0bd82be27e8b/grepout.txt > /tmp/51srtkt0/grepout.txt
INFO [job 1_grep] completed success
INFO [step 1_grep] completed success
INFO [workflow ] starting step 2_wc
INFO [step 2_wc] start
INFO [job 2_wc] /tmp/bkrv17e7$ wc \
    -l \
    /tmp/_1sj1zbz/stg729c8fba-f536-4f74-a7fe-e9dc49ebd3e7/grepout.txt > /tmp/bkrv17e7/wc_out.txt
INFO [job 2_wc] completed success
INFO [step 2_wc] completed success
INFO [workflow ] completed success
{
    "counts": {
        "location": "file:///workspaces/togotv_shooting/zatsu_generator/wc_out.txt",
        "basename": "wc_out.txt",
        "class": "File",
        "checksum": "sha1$58b721e8d56d12e12a31f7ec435491bf3faa767f",
        "size": 68,
        "path": "/workspaces/togotv_shooting/zatsu_generator/wc_out.txt"
    }
}INFO Final process status is success

```

ã“ã®ã‚ˆã†ã«å‡¦ç†ã•ã‚Œï½¤æœ€çµ‚çš„ã«wc\_out.txtãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï½¡

&nbsp;
  
&nbsp;

# ã€Case2ã€‘ãƒã‚¤ã‚ªã‚¤ãƒ³ãƒ•ã‚©ãƒžãƒ†ã‚£ã‚¯ã‚¹ã®è§£æžã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åŒ–ã™ã‚‹

æ¬¡ã«ï½¤ å…·ä½“çš„ã«ç”Ÿå‘½ç§‘å­¦ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ãŸä¾‹ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦è¨˜è¿°ã—ã¦ã¿ã‚‹ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ï½¡

ä»Šå›žã¯ï½¤

**(1) BLASTpã‚³ãƒžãƒ³ãƒ‰ã«ã‚ˆã‚‹é…åˆ—é¡žä¼¼æ€§æ¤œç´¢**
**(2)awkã«ã‚ˆã‚‹ãƒ’ãƒƒãƒˆã—ãŸIDã®æŠ½å‡º**
**(3)blastdbcmdã«ã‚ˆã‚‹ãƒ’ãƒƒãƒˆã—ãŸIDã®fastaãƒ•ã‚¡ã‚¤ãƒ«ã®æŠ½å‡º**
**(4) ClustalOmegaã«ã‚ˆã‚‹ãƒžãƒ«ãƒãƒ—ãƒ«ã‚¢ãƒ©ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆ**
**(5)fasttreeã«ã‚ˆã‚‹ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—å€¤ã®ç®—å‡º**

ã®5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦è¨˜è¿°ã—ã¦ã¿ã¾ã™ï½¡

ä»Šå›žå–ã‚Šä¸Šã’ãŸãƒ„ãƒ¼ãƒ«ã‚’ã†ã¡ï½¤awkä»¥å¤–ã¯Biocontainersã«ã‚ˆã£ã¦docker imageãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™(awkã¯Ubuntu:23.10ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™)ï½¡
docker hubã®ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ï½¤ã‚³ãƒžãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚‰ã®imageã‚’pullã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï½¡


:::danger
__ä¿®æ­£1ï¼šã¾ãšdockerãªã—ã®çŠ¶æ…‹ã§è¨˜è¿°ã—ãŸå¾Œï½¤dockerã«ã¤ã„ã¦è¨˜è¿°ã™ã‚‹__
__ä¿®æ­£2ï¼š`arguments`ã§ã¯ãªãï½¤`hints`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›¸ã(æ¡ä»¶ãŒã‚†ã‚‹ã„)__
__ä¿®æ­£3ï¼šdockerã®èª¬æ˜Žã®ã‚ã¨ã«singularityã®èª¬æ˜Žã‚’åŠ ãˆã‚‹__
:::

&nbsp;

## docker imageã‚’å–å¾—ã™ã‚‹

ã¾ãšï½¤ãã‚Œãžã‚Œã®docker imageã‚’docker hubã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï½¡ tag ã‚’æŒ‡å®šã™ã‚‹å½¢ã§ä»Šå›žã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰(docker pull ... ã‚’ã‚³ãƒ”ãƒ¼& ãƒšãƒ¼ã‚¹ãƒˆ)ã—ã¾ã—ãŸï½¡

ä»¥ä¸‹ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ `docker image ls` ã‚’è¡Œã£ãŸä¾‹ã§ã™ï½¡

```bash=
docker image ls
REPOSITORY               TAG                 IMAGE ID       CREATED       SIZE
ubuntu                   23.10               78938b354ee7   2 weeks ago   72.1MB
biocontainers/fasttree   v2.1.10-2-deb_cv1   bdfde5d6026c   4 years ago   118MB
biocontainers/clustalo   v1.2.4-2-deb_cv1    d14a5e27e301   4 years ago   118MB
biocontainers/blast      v2.2.31_cv2         5b25e08b9871   4 years ago   2.03GB
```

&nbsp;

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æº–å‚™ã‚’è¡Œã†

æ¬¡ã«ï½¤ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¦ã„ãã¾ã™ï½¡

### 1\. ã‚¯ã‚¨ãƒªé…åˆ—

blastpã‚’å®Ÿè¡Œã™ã‚‹ã®ã§ï½¤ä»Šå›žã‚¯ã‚¨ãƒªã¨ã™ã‚‹ã®ã¯ï½¤Â ã‚¦ã‚·ã®ãƒŸã‚ªã‚¹ã‚¿ãƒãƒ³ã®ã‚¿ãƒ³ãƒ‘ã‚¯è³ªé…åˆ—ã®fastaãƒ•ã‚¡ã‚¤ãƒ« (MSTN.fastaã«åå‰ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™)ã§ã™ï½¡ curlã‚³ãƒžãƒ³ãƒ‰ã§å–å¾—ã—ã¾ã—ãŸï½¡

```bash=
curl -O https://rest.uniprot.org/uniprotkb/O18836.fasta
```


### 2\. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)

æ¬¡ã«ï½¤BLASTã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹UniProtã®ã‚¿ãƒ³ãƒ‘ã‚¯è³ªé…åˆ—ã®fastaãƒ•ã‚¡ã‚¤ãƒ«(uniprot\_sprot.fasta.gz)ã‚’ftpã‚µã‚¤ãƒˆã‚ˆã‚Šcurlã‚³ãƒžãƒ³ãƒ‰ã§å–å¾—ã—ã¾ã—ãŸï½¡Â 

```bash=
curl -O https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/complete/ uniprot_sprot.fasta.gz  
``` 

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã™ã‚‹ãŸã‚ã«ï½¤ `makeblastdb` ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï½¡ ãªãŠï½¤ã“ã®éƒ¨åˆ†ã®å‡¦ç†ã¯ï½¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«çµ„ã¿è¾¼ã¾ãªã„å½¢ã§è¨˜è¿°ã—ã¾ã—ãŸï½¡`makeblastdb` ã‚³ãƒžãƒ³ãƒ‰ ã®å®Ÿè¡Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã„ã¾ã—ãŸï½¡

```bash=
docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/blast:v2.2.31_cv2 makeblastdb -in uniprot_sprot.fasta -dbtype prot -hash_index -parse_seqids 
```

&nbsp;

## å®Ÿéš›ã«CWLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã„ã¦ã¿ã‚‹ (CommandLineToolç·¨)

æ¬¡ã«ï½¤å®Ÿéš›ã®å‡¦ç†ã«ã¤ã„ã¦ï½¤CWLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã—ã‚‡ã†ï½¡ ä»Šå›žå®Ÿè¡Œã™ã‚‹5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚³ãƒžãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ï½¡

```bash=
# Step1
docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/blast:v2.2.31_cv2 blastp -query MSTN.fasta -db uniprot_sprot.fasta -evalue 1e-5 -num_threads 4 -outfmt 6 -out blastp_result_MSTN.txt -max_target_seqs 20 

# Step2
docker run --rm -it -v `pwd`:`pwd` -w `pwd` awk '{ print $2 }' blastp_result_MSTN2.txt > blastp_result_id.txt

#Step3
docker run --rm -it -v `pwd`:`pwd`  -w  `pwd` biocontainers/blast:v2.2.31_cv2 blastdbcmd -db uniprot_sprot.fasta -entry_batch blastp_result_id.txt  -out blastp_results_MSTN.fasta

#Step4
docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/clustalo:v1.2.4-2-deb_cv1 clustalo -i `pwd`/blastp_results_MSTN.fasta --outfmt=fasta -o MSTN_aligned_sequence.fasta

#Step5
docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/fasttree:v2.1.10-2-deb_cv1 FastTree -out MSTN_tree.newick `pwd`/MSTN_aligned_sequence.fasta
```

&nbsp;

### zatsu-cwl-generatorã‚’ä½¿ãŠã†

ã“ã‚Œã‚‰ã‚’æ‰‹ä½œæ¥­ã§æ›¸ãã¨ã„ã†æ–¹æ³•ã«åŠ ãˆã¦ï½¤ã™ã§ã«ã“ã®ç’°å¢ƒã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ ï½¢zatsu-cwl-generatorï½£ ã‚’ä½¿ã£ã¦ï½¤ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ã‚ã‚‹ç¨‹åº¦å‡ºåŠ›ã—ã¦ã‚‚ã‚‰ã†ï½¤ã¨ã„ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ï½¡ä»Šå›žã¯ã“ã®æ–¹æ³•ã‚’è©¦ã—ã¦ã¿ã¾ã™ï½¡

zatsu-cwl-generator ã« ã‚³ãƒžãƒ³ãƒ‰ã‚’""ã§å›²ã‚“ã§å…¥åŠ›ã—ã¾ã™ï½¡

:::danger
__å¤‰æ›´ï¼š`-c`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã®å ´åˆã‚’ç´¹ä»‹ã™ã‚‹__
__å¤‰æ›´ï¼šå‡ºåŠ›ã•ã‚ŒãŸçµæžœã‚’__
:::

```bash=
zatsu-cwl-generator "docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/blast:v2.2.31_cv2 blastp -query MSTN.fasta -db uniprot_sprot.fasta -evalue 1e-5 -num_threads 4 -outfmt 6 -out blastp_result_MSTN.txt -max_target_seqs 20" > blastp.cwl
```

  

å‡ºåŠ›ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï½¡ ãŸã ã—ï½¤ã“ã‚ŒãŒå®Œæˆç‰ˆã§ã¯ãªãï½¤å®Ÿéš›ã«ç¢ºèªã—ã¦ä¿®æ­£ã™ã‚‹ã“ã¨ãŒå¿…è¦ã§ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/blast:v2.2.31_cv2 blastp -query MSTN.fasta -db uniprot_sprot.fasta -evalue 1e-5 -num_threads 4 -outfmt 6 -out blastp_result_MSTN.txt -max_target_seqs 20
class: CommandLineTool
cwlVersion: v1.0
baseCommand: docker
arguments:
  - $(inputs.run)
  - --rm
  - -it
  - -v
  - $(inputs.v)
  - -w
  - $(inputs.w)
  - $(inputs.blast:v2_2_31_cv2)
  - $(inputs.blastp)
  - -query
  - $(inputs.query)
  - -db
  - $(inputs.db)
  - -evalue
  - $(inputs.evalue)
  - -num_threads
  - $(inputs.num_threads)
  - -outfmt
  - $(inputs.outfmt)
  - -out
  - $(inputs.out)
  - -max_target_seqs
  - $(inputs.max_target_seqs)
inputs:
  - id: run
    type: Any
    default: run
  - id: v
    type: Any
    default: `pwd`:`pwd`
  - id: w
    type: Any
    default: `pwd`
  - id: blast:v2_2_31_cv2
    type: File
    default:
      class: File
      location: biocontainers/blast:v2.2.31_cv2
  - id: blastp
    type: Any
    default: blastp
  - id: query
    type: File
    default:
      class: File
      location: MSTN.fasta
  - id: db
    type: File
    default:
      class: File
      location: uniprot_sprot.fasta
  - id: evalue
    type: Any
    default: 1e-5
  - id: num_threads
    type: int
    default: 4
  - id: outfmt
    type: int
    default: 6
  - id: out
    type: File
    default:
      class: File
      location: blastp_result_MSTN.txt
  - id: max_target_seqs
    type: int
    default: 20
outputs:
  - id: all-for-debugging
    type:
      type: array
      items: [File, Directory]
    outputBinding:
      glob: "*"
```

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã©ã®è¨˜è¿°ãŒæ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚Œã¾ã™ï½¡ ã—ã‹ã—ãªãŒã‚‰ï½¤ä¿®æ­£ã™ã¹ãç‚¹ãŒã‚ã‚Šã¾ã™ã®ã§ä¿®æ­£ã—ã¦ã„ãã¾ã—ã‚‡ã†ï½¡

&nbsp;

### dockerã‚’ä½¿ã†æ™‚ã¯...
ã¾ãšï½¤å¤§ããªç‚¹ã¨ã—ã¦ï½¤baseCommand ã®ä¿®æ­£ãŒã‚ã‚Šã¾ã™ï½¡
ã“ã“ã§å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã§ã™ãŒï½¤ã“ã“ã«ã¯docker ã§ã¯ãªãï½¤blastpã¨æ›¸ãç›´ã—ã¾ã™ï½¡
ã“ã‚Œã¯ï½¤`docker run` ... ã‹ã‚‰ã¯ã˜ã¾ã‚‹éƒ¨åˆ†ã®å‡¦ç†ã¯å…¨ã¦CWLã§å‡¦ç†ã—ã¦ãã‚Œã¾ã™ï½¡
ãªãŠï½¤docker(ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ã†ã“ã¨ã‚’æ˜Žç¤ºã™ã‚‹)ã¯ "requirements" ã®éƒ¨åˆ†ã§è¨˜è¿°ã—ã¾ã™ï½¡
  

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/blast:v2.2.31_cv2 blastp -query MSTN.fasta -db uniprot_sprot.fasta -evalue 1e-5 -num_threads 4 -outfmt 6 -out blastp_result_MSTN.txt -max_target_seqs 20

class: CommandLineTool
cwlVersion: v1.0
baseCommand: [blastp] 

requirements:
  DockerRequirement: 
    dockerPull: "biocontainers/blast:v2.2.31_cv2"  #ã“ã“ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ›¸ã
```
&nbsp; 

### å‚è€ƒï¼š5.5 DockerRequirement(Common Workflow Language (CWL) Command Line Tool Description, v1.0.2ã‚ˆã‚Š)

[![Dockerrequirement](https://hackmd.io/_uploads/r16IJoZxT.png)](https://www.commonwl.org/v1.0/CommandLineTool.html#DockerRequirement)

&nbsp;

:::danger
__è¿½è¨˜ï¼šshebangã‚’æ›¸ãã‹ã©ã†ã‹__(çµè«–ï¼šã©ã¡ã‚‰ã§ã‚‚å¤§ä¸ˆå¤«)

__è¿½è¨˜ï¼šzatsu-cwl-generatorã‚’ã‚‚ã£ã¨ä½¿ã£ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‡ºåŠ›__


:::

&nbsp;

æ¬¡ã«Case1ã§ã‚‚æ›¸ã„ã¦ã„ãŸ`inputs` `outputs` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦è¨˜è¿°ã—ã¾ã™ï½¡ `arguments`ã®éƒ¨åˆ†ã¯ä»Šå›žã¯è¨˜è¿°ã—ãªã„æ–¹æ³•ã§æ›¸ã„ã¦ã„ãã¾ã™ï½¡ å®Ÿéš›ã«æ›¸ã„ã¦ã¿ãŸã®ãŒä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãªã‚Šã¾ã™ï½¡

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v `pwd`:`pwd` -w `pwd` biocontainers/blast:v2.2.31_cv2 blastp -query MSTN.fasta -db uniprot_sprot.fasta -evalue 1e-5 -num_threads 4 -outfmt 6 -out blastp_result_MSTN.txt -max_target_seqs 20
class: CommandLineTool
cwlVersion: v1.0
baseCommand: [blastp]
doc: BLASTP step 

requirements:
  DockerRequirement: #Dockerimageã‚’è¨˜è¿°
    dockerPull: "biocontainers/blast:v2.2.31_cv2"

# input
inputs:
  protein_query:
    type: File
    inputBinding:
      prefix: "-query"
      position: 1
  protein_database:
    type: File
    default: 
      class: File
      path: ../data/uniprot_sprot.fasta
    inputBinding:
      prefix: "-db"
      position: 2
    secondaryFiles:
      - ^.fasta.phd
      - ^.fasta.phi
      - ^.fasta.phr
      - ^.fasta.pin
      - ^.fasta.pog
      - ^.fasta.psd
      - ^.fasta.psi
      - ^.fasta.psq

  e-value:
    type: float?
    default: 1e-5
    inputBinding:
      prefix: "-evalue"
      position: 3
  number_of_threads:
    type: int
    default: 4
    inputBinding:
      prefix: "-num_threads"
      position: 4
  outformat_type:
    type: int
    default: 6
    inputBinding:
      prefix: "-outfmt"
      position: 5
  output_file_name:
    type: string
    inputBinding:
      prefix: "-out"
      position: 6
  max_target_sequence:
    type: int
    default: 20
    inputBinding:
      prefix: "-max_target_seqs"
      position: 7

#outputs
outputs:
  blastp_output_file:
    type: File
    outputBinding:
      glob: "$(inputs.output_file_name)"

# stdout
stdout: $(inputs.output_file_name)
```
&nbsp;

:::success
### BLASTã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ›¸ãæ–¹

BLASTã§ã¯ï½¤inputsã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(å¼•æ•°ã¯ `-db` )ã®æŒ‡å®šã®éƒ¨åˆ†ã®è¨˜è¿°æ–¹æ³•ã«ã¤ã„ã¦ã„ãã¤ã‹æ–¹æ³•ãŒã‚ã‚‹ã‚ˆã†ã§ã™ï½¡

ä¾‹ãˆã°ä»Šå›žã¯ `secondaryFiles` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ´»ç”¨ã—ï½¤ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¦ã„ã¾ã™ï½¡ 

```yaml=
  protein_database:
    type: File
    default: 
      class: File
      path: ../data/uniprot_sprot.fasta #pathã‚’è¨˜è¿°
    inputBinding:
      prefix: "-db"
      position: 2
    secondaryFiles:
      - ^.fasta.phd
      - ^.fasta.phi
      - ^.fasta.phr
      - ^.fasta.pin
      - ^.fasta.pog
      - ^.fasta.psd
      - ^.fasta.psi
      - ^.fasta.psq
```
ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æŒ‡å®šã—ã¦ãŠãï½¤ãƒ‘ã‚¹ã«ã¤ã„ã¦ã‚‚æ˜Žè¨˜ã—ã¦ã„ã¾ã™ï½¡ã¾ãŸï½¤`secandaryFiles`ã§ï½¤ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‚ç…§æ™‚ã«protein_databaseã«æŒ‡å®šã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãªãã¦ã¯ã„ã‘ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ï½¡

#### å‚è€ƒ1ï¼š[cwl-samples-2023/debuginfo.cwl](https://github.com/manabuishii/cwl-samples-2023/blob/main/debuginfo.cwl#L10-L11)
#### å‚è€ƒ2ï¼š[5.1 CommandInputParameter](https://www.commonwl.org/v1.0/CommandLineTool.html#CommandInputParameter)
:::
  
&nbsp;

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ã¾ã¨ã‚ã¦ä¸Žãˆã‚‹

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¸€ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï½¡
ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒå¯èƒ½ã§ã™ï½¡

```yaml=
protein_query: 
  class: File
  path: ../data/MSTN.fasta
protein_database: 
  class: File
  path: ../data/uniprot_sprot.fasta
e-value: 1e-5
number_of_threads: 4
outformat_type: 6
output_file_name: "blastp_result.txt"
max_target_sequence: 20

```
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï½¡

&nbsp;

### 1_blastp.cwlã®å®Ÿè¡Œ

```bash=
cwltool --outdir ./data ./Tools/1_blastp.cwl ./Tools/1_blastp.yml
```
ä»Šå›žã¯`--outdir`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ï½¤å‡ºåŠ›å…ˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ï½¡

&nbsp;

```bash=
INFO /usr/local/bin/cwltool 3.1.20230906142556
INFO Resolved './Tools/1_blastp.cwl' to 'file:///workspaces/togotv_shooting/Tools/1_blastp.cwl'
INFO [job 1_blastp.cwl] /tmp/qe5n7kgg$ docker \
    run \
    -i \
    --mount=type=bind,source=/tmp/qe5n7kgg,target=/DcjUoi \
    --mount=type=bind,source=/tmp/p__s1km1,target=/tmp \
    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-9100
606072ca/uniprot_sprot.fasta,readonly \                                                                                                  --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phd,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.phd,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phi,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.phi,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phr,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.phr,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.pin,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.pin,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.pog,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.pog,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psd,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.psd,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psi,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.psi,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psq,target=/var/lib/cwl/stgd1ff326d-ac51-4352-b27b-
9100606072ca/uniprot_sprot.fasta.psq,readonly \                                                                                          --mount=type=bind,source=/workspaces/togotv_shooting/data/MSTN.fasta,target=/var/lib/cwl/stge2ab10d6-20a1-4698-88fe-dc0997863178/
MSTN.fasta,readonly \                                                                                                                    --workdir=/DcjUoi \
    --read-only=true \
    --user=1000:1000 \
    --rm \
    --cidfile=/tmp/d3yca0_g/20230928025733-664451.cid \
    --env=TMPDIR=/tmp \
    --env=HOME=/DcjUoi \
    biocontainers/blast:v2.2.31_cv2 \
    blastp \
    -query \
    /var/lib/cwl/stge2ab10d6-20a1-4698-88fe-dc0997863178/MSTN.fasta \
    -db \
    /var/lib/cwl/stgd1ff326d-ac51-4352-b27b-9100606072ca/uniprot_sprot.fasta \
    -evalue \
    0.00001 \
    -num_threads \
    4 \
    -outfmt \
    6 \
    -out \
    blastp_result.txt \
    -max_target_seqs \
    20
INFO [job 1_blastp.cwl] Max memory used: 11MiB
INFO [job 1_blastp.cwl] completed success
{
    "blastp_output_file": {
        "location": "file:///workspaces/togotv_shooting/data/blastp_result.txt",
        "basename": "blastp_result.txt",
        "class": "File",
        "checksum": "sha1$31464e2d0bdfd65f89e0542688844d3686bf278c",
        "size": 1536,
        "path": "/workspaces/togotv_shooting/data/blastp_result.txt"
    }
}INFO Final process status is success

```
å®Ÿè¡ŒãŒæˆåŠŸã—ãŸã‚ˆã†ã§ã™ï½¡blastpã®çµæžœã‚‚å‡ºåŠ›ã•ã‚Œã¾ã—ãŸï½¡
åŒæ§˜ã«ä»–ã®CWLãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ï½¤zatsu-cwl-generatorã§ä¸€æ—¦å‡ºåŠ›å¾Œï½¤ä¿®æ­£ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï½¡ãã®çµæžœã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ï½¡ 

&nbsp;

## CWLãƒ•ã‚¡ã‚¤ãƒ«(CommandLineTool)è¨˜è¿°ä¾‹

### 2_awk.cwl

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v `pwd`:`pwd` -w `pwd` ubuntu:23.10 awk '{ print $2 }' blastp_result_MSTN.txt > blastp_result_id.txt
class: CommandLineTool
cwlVersion: v1.0
baseCommand: [awk]

requirements:
  DockerRequirement:
    dockerPull: "ubuntu:23.10"

# å›ºå®šã®å¼•æ•°
arguments:
  - valueFrom: '{ print $2 }' 
    position: 1

inputs:
  blastp_result:
    type: File
    inputBinding:
      position: 2
  output_id_file_name:
    type: string
    inputBinding:
      position: 3
outputs:
  awk_output:
    type: File
    outputBinding:
      glob: "$(inputs.output_id_file_name)"
stdout: $(inputs.output_id_file_name)
```

&nbsp;

### 3\_blastdbcmd.cwl

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v /workspaces/togotv_shooting/data:/workspaces/togotv_shooting/data  -w  /workspaces/togotv_shooting/data biocontainers/blast:v2.2.31_cv2 blastdbcmd -db uniprot_sprot.fasta -entry_batch blastp_result_id.txt  -out blastp_results_MSTN.fasta
class: CommandLineTool
cwlVersion: v1.0
baseCommand: [blastdbcmd]

requirements:
  DockerRequirement:
    dockerPull: "biocontainers/blast:v2.2.31_cv2"

# Inputs
inputs:
  blastdbcmd_protein_database:
    type: File
    default: 
      class: File
      path: ../data/uniprot_sprot.fasta
    inputBinding:
      prefix: "-db"
      position: 1
    secondaryFiles:
      - ^.fasta.phd
      - ^.fasta.phi
      - ^.fasta.phr
      - ^.fasta.pin
      - ^.fasta.pog
      - ^.fasta.psd
      - ^.fasta.psi
      - ^.fasta.psq
  id_query:
    type: File
    inputBinding:
      prefix: "-entry_batch"
      position: 2
  blastdbcmd_output_name:
    type: string
    inputBinding:
      prefix: "-out"
      position: 3
#Outputs
outputs:
  blastdbcmd_output:
    type: File
    outputBinding:
      glob: "$(inputs.blastdbcmd_output_name)"
```

&nbsp;

### 4_clustalo.cwl

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v /workspaces/togotv_shooting/data:/workspaces/togotv_shooting/data -w /workspaces/togotv_shooting/data biocontainers/clustalo:v1.2.4-2-deb_cv1 clustalo -i /workspaces/togotv_shooting/data/blastp_results_MSTN.fasta --outfmt=fasta -o MSTN_aligned_sequence.fasta
class: CommandLineTool
cwlVersion: v1.0
baseCommand: [clustalo]

requirements:
  DockerRequirement:
    dockerPull: "biocontainers/clustalo:v1.2.4-2-deb_cv1"

# Inputs
inputs:
  clustalo_inputs:
    type: File
    inputBinding:
      prefix: "-i"
      position: 1
  clustalo_format:
    type: string
    default: "fasta"
    inputBinding:
      prefix: "--outfmt"
      position: 2
  clustalo_output_name:
    type: string
    inputBinding:
      prefix: "-o"
      position: 3

outputs:
  clustalo_output:
    type: File
    outputBinding:
      glob: "$(inputs.clustalo_output_name)"
```

&nbsp; 

### 5_fasttree.cwl

```yaml=
#!/usr/bin/env cwl-runner
# Generated from: docker run --rm -it -v /workspaces/togotv_shooting/data:/workspaces/togotv_shooting/data -w /workspaces/togotv_shooting/data biocontainers/fasttree:v2.1.10-2-deb_cv1 FastTree -out MSTN_tree.newick /workspaces/togotv_shooting/data/MSTN_aligned_sequence.fasta
class: CommandLineTool
cwlVersion: v1.0
baseCommand: [fasttree]

requirements:
  DockerRequirement:
    dockerPull: "biocontainers/fasttree:v2.1.10-2-deb_cv1"

#Inputs
inputs:
  fasttree_output_file_name:
    type: string
    inputBinding:
      prefix: "-out"
      position: 1
  fasttree_input_file:
    type: File
    inputBinding:
      position: 2
# Outputs
outputs:
  fasttree_output_file:
    type: File
    outputBinding:
      glob: "$(inputs.fasttree_output_file_name)" 
```

&nbsp;

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨˜è¿°ã™ã‚‹

:::danger
__ä¿®æ­£ï¼šbest practicesã«è¼‰ã£ã¦ã„ã‚‹ã‚ˆã†ãªæ›¸ãæ–¹ã§æœ€å¾Œæ›¸ã__
:::

ã“ã‚Œã¾ã§ï½¤Commanlinetoolã®CWLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸï½¡æ¬¡ã«ã“ã‚Œã‚‰ã®5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ï½¡ã“ã®ä¾‹ã§ã¯ï½¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ï½¢1\_protein\_queryï½£ã®ã‚ˆã†ã«æ•°å­—ã‚’ã¤ã‘ã¦ã„ã¾ã™ï½¡ å‰ã®å‡¦ç†ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’å—ã‘å–ã‚‹éƒ¨åˆ†ã¯ï½¢blastp\_result: step1\_blastp/blastp\_output\_fileï½£ã®ã‚ˆã†ã«è¨˜è¿°ã—ï½¤ãã‚Œä»¥å¤–ã®å…¨ã¦ã®å‡¦ç†ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’inputsã§è¨˜è¿°ã—ã¦ã„ã¾ã™ï½¡
```yaml=
#!/usr/bin/env cwl-runner
cwlVersion: v1.0
class: Workflow
doc: "5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: blastp, awk, blastdbcmd, clustalo, and fasttree"
#æœ€åˆã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã®ã¿è¨˜è¿°ã—ã‚ˆã†ã¨æ€ã£ãŸãŒï½¤å…¨éƒ¨æ›¸ã„ã¦ã‚ã‹ã‚Šã‚„ã™ãæ›¸ãæ–¹é‡ã«
# å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã®æ›¸ãæ–¹ã«æ³¨æ„
inputs: 
  #blastp
  1_protein_query: 
    type: File
  2_protein_database:
    type: File
    secondaryFiles:
      - ^.fasta.phd
      - ^.fasta.phi
      - ^.fasta.phr
      - ^.fasta.pin
      - ^.fasta.pog
      - ^.fasta.psd
      - ^.fasta.psi
      - ^.fasta.psq
  3_e-value: 
    type: float?
  4_number_of_threads: 
    type: int
  5_outformat_type: 
    type: int
  6_output_file_name: 
    type: string
  7_max_target_sequence: 
    type: int
  #awk
  8_output_id_file_name:
    type: string
  #blastdbcmd
  9_blastdbcmd_protein_database:
    type: File
    secondaryFiles:
      - ^.fasta.phd
      - ^.fasta.phi
      - ^.fasta.phr
      - ^.fasta.pin
      - ^.fasta.pog
      - ^.fasta.psd
      - ^.fasta.psi
      - ^.fasta.psq
  10_blastdbcmd_output_name:
    type: string
  #clustalo
  11_clustalo_format:
    type: string
  12_clustalo_output_name:
    type: string
  #fasttree
  13_fasttree_output_file_name:
    type: string
  

outputs:
  final_output_bootstrap: 
    type: File
    outputSource: step5_fasttree/fasttree_output_file
steps:
  step1_blastp:
    run: ../Tools/1_blastp.cwl 
    in: 
      protein_query: 1_protein_query
      protein_database: 2_protein_database
      e-value: 3_e-value
      number_of_threads: 4_number_of_threads
      outformat_type: 5_outformat_type
      output_file_name: 6_output_file_name
      max_target_sequence: 7_max_target_sequence
    out: [blastp_output_file] 

  step2_awk:
    run: ../Tools/2_awk.cwl
    in:
      blastp_result: step1_blastp/blastp_output_file 
      output_id_file_name: 8_output_id_file_name
    out: [awk_output]

  step3_blastdbcmd:
    run: ../Tools/3_blastdbcmd.cwl
    in: 
      blastdbcmd_protein_database: 9_blastdbcmd_protein_database
      id_query: step2_awk/awk_output 
      blastdbcmd_output_name: 10_blastdbcmd_output_name
    out: [blastdbcmd_output]

  step4_clustalo:
    run: ../Tools/4_clustalo.cwl
    in:
      clustalo_inputs: step3_blastdbcmd/blastdbcmd_output
      clustalo_format: 11_clustalo_format
      clustalo_output_name: 12_clustalo_output_name
    out: [clustalo_output]

  step5_fasttree:
    run: ../Tools/5_fasttree.cwl
    in:
      fasttree_output_file_name: 13_fasttree_output_file_name
      fasttree_input_file: step4_clustalo/clustalo_output
    out: [fasttree_output_file]
```

æœ€å¾Œã«å…¨ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(1\_protein\_queryã®ã‚ˆã†ã«æ›¸ã„ã¦ã„ã‚‹éƒ¨åˆ†)ã‚’è¨˜è¿°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ« ã‚’ä½œæˆã—ã¾ã™ï½¡ã™ã§ã«è¿°ã¹ãŸã‚ˆã†ã«ï½¤ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã¾ã¨ã‚ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï½¡

ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¿°ã«ãªã‚Šã¾ã—ãŸï½¡

&nbsp;

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«(YAMLãƒ•ã‚¡ã‚¤ãƒ«)

```yaml=
# 1_blastp.cwl ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
1_protein_query:
  class: File
  path: ../data/MSTN.fasta
2_protein_database:
  class: File
  path: ../data/uniprot_sprot.fasta
3_e-value: 1e-5
4_number_of_threads: 4
5_outformat_type: 6
6_output_file_name: "blastp_result.txt"
7_max_target_sequence: 20

# 2_awk.cwl ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
8_output_id_file_name: "blastp_result_id.txt"

# 3_blastdbcmd.cwl ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
9_blastdbcmd_protein_database:
  class: File
  path: "../data/uniprot_sprot.fasta"
10_blastdbcmd_output_name: "blastdbcmd_output.fasta"

# 4_clustalo.cwl ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
11_clustalo_format: "fasta"
12_clustalo_output_name: "clustalo_output.fasta"

# 5_fasttree.cwl ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
13_fasttree_output_file_name: "fasttree_output.newick"
```

&nbsp;

æœ€å¾Œã«`cwltool â€“-validate`ã‚’å®Ÿè¡Œã—ã¾ã™ï½¡
```yaml=
cwltool --validate ./workflow/6_phylogenetic-workflow.cwl ./workflow/input.yaml
INFO /usr/local/bin/cwltool 3.1.20230906142556
INFO Resolved './workflow/6_phylogenetic-workflow.cwl' to 'file:///workspaces/togotv_shooting/workflow/6_phylogenetic-workflow.cwl'
./workflow/6_phylogenetic-workflow.cwl is valid CWL.
```

æ›¸ãæ–¹ã¨ã—ã¦ã¯å•é¡ŒãŒç„¡ã„ã‚ˆã†ã§ã™ï½¡
ç¶šã„ã¦ï½¤CWLãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦`--help`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ã¿ã¾ã™ï½¡

```bash=
cwltool ./workflow/6_phylogenetic-workflow.cwl --help
```

:::danger
__è¿½è¨˜ï¼šã“ã“ã§ã‚‚å…ˆé ­ä½•è¡Œã‹è¦‹ã›ã¦ï½¤docãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›¸ãã“ã¨ã®ã”åˆ©ç›ŠãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã‚’æ›¸ã__
:::


ãã‚Œã§ã¯ï½¤å®Ÿéš›ã«å®Ÿè¡Œã—ã¦ã¿ã¾ã™ï½¡

```yaml=
cwl-runner ./workflow/6_phylogenetic-workflow.cwl ./workflow/input.yml
```

å®Ÿè¡Œçµæžœ
```bash=
INFO /usr/local/bin/cwl-runner 3.1.20230906142556
INFO Resolved './workflow/6_phylogenetic-workflow.cwl' to 'file:///workspaces/togotv_shooting/workflow/6_phylogenetic-workflow.cwl
'                                                                                                                                 INFO [workflow ] start
INFO [workflow ] starting step step1_blastp
INFO [step step1_blastp] start
INFO [job step1_blastp] /tmp/2s81aqwz$ docker \
    run \
    -i \
    --mount=type=bind,source=/tmp/2s81aqwz,target=/XKQdXE \
    --mount=type=bind,source=/tmp/omtpty6t,target=/tmp \
    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2d2-f
7dc16036a89/uniprot_sprot.fasta,readonly \                                                                                            --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phd,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.phd,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phi,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.phi,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phr,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.phr,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.pin,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.pin,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.pog,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.pog,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psd,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.psd,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psi,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.psi,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psq,target=/var/lib/cwl/stg9579ad21-d27b-4919-a2
d2-f7dc16036a89/uniprot_sprot.fasta.psq,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/MSTN.fasta,target=/var/lib/cwl/stg074f1962-1693-4b69-8f5d-66b5ca45e6
76/MSTN.fasta,readonly \                                                                                                              --workdir=/XKQdXE \
    --read-only=true \
    --user=1000:1000 \
    --rm \
    --cidfile=/tmp/2fxzkh85/20230928045240-374338.cid \
    --env=TMPDIR=/tmp \
    --env=HOME=/XKQdXE \
    biocontainers/blast:v2.2.31_cv2 \
    blastp \
    -query \
    /var/lib/cwl/stg074f1962-1693-4b69-8f5d-66b5ca45e676/MSTN.fasta \
    -db \
    /var/lib/cwl/stg9579ad21-d27b-4919-a2d2-f7dc16036a89/uniprot_sprot.fasta \
    -evalue \
    0.00001 \
    -num_threads \
    4 \
    -outfmt \
    6 \
    -out \
    blastp_result.txt \
    -max_target_seqs \
    20
INFO [job step1_blastp] Max memory used: 6MiB
INFO [job step1_blastp] completed success
INFO [step step1_blastp] completed success
INFO [workflow ] starting step step2_awk
INFO [step step2_awk] start
INFO [job step2_awk] /tmp/dll4rpk0$ docker \
    run \
    -i \
    --mount=type=bind,source=/tmp/dll4rpk0,target=/XKQdXE \
    --mount=type=bind,source=/tmp/end82mmy,target=/tmp \
    --mount=type=bind,source=/tmp/2s81aqwz/blastp_result.txt,target=/var/lib/cwl/stg79db6e9b-c182-4436-8210-c6e4c82c3883/blastp_re
sult.txt,readonly \                                                                                                                   --workdir=/XKQdXE \
    --read-only=true \
    --log-driver=none \
    --user=1000:1000 \
    --rm \
    --cidfile=/tmp/hp2d02kz/20230928045242-157190.cid \
    --env=TMPDIR=/tmp \
    --env=HOME=/XKQdXE \
    ubuntu:23.10 \
    awk \
    '{ print $2 }' \
    /var/lib/cwl/stg79db6e9b-c182-4436-8210-c6e4c82c3883/blastp_result.txt \
    blastp_result_id.txt > /tmp/dll4rpk0/blastp_result_id.txt
INFO [job step2_awk] completed success
INFO [step step2_awk] completed success
INFO [workflow ] starting step step3_blastdbcmd
INFO [step step3_blastdbcmd] start
INFO [job step3_blastdbcmd] /tmp/qjene9aj$ docker \
    run \
    -i \
    --mount=type=bind,source=/tmp/qjene9aj,target=/XKQdXE \
    --mount=type=bind,source=/tmp/_adhvpty,target=/tmp \
    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4ba-3
1f50dcb2572/uniprot_sprot.fasta,readonly \                                                                                            --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phd,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.phd,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phi,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.phi,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.phr,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.phr,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.pin,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.pin,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.pog,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.pog,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psd,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.psd,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psi,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.psi,readonly \                                                                                    --mount=type=bind,source=/workspaces/togotv_shooting/data/uniprot_sprot.fasta.psq,target=/var/lib/cwl/stgcc8a126f-0ce6-4f81-a4
ba-31f50dcb2572/uniprot_sprot.fasta.psq,readonly \                                                                                    --mount=type=bind,source=/tmp/dll4rpk0/blastp_result_id.txt,target=/var/lib/cwl/stg0b724761-074f-4d10-aaf8-8109d1c3da00/blastp
_result_id.txt,readonly \                                                                                                             --workdir=/XKQdXE \
    --read-only=true \
    --user=1000:1000 \
    --rm \
    --cidfile=/tmp/8kcrikj8/20230928045243-166987.cid \
    --env=TMPDIR=/tmp \
    --env=HOME=/XKQdXE \
    biocontainers/blast:v2.2.31_cv2 \
    blastdbcmd \
    -db \
    /var/lib/cwl/stgcc8a126f-0ce6-4f81-a4ba-31f50dcb2572/uniprot_sprot.fasta \
    -entry_batch \
    /var/lib/cwl/stg0b724761-074f-4d10-aaf8-8109d1c3da00/blastp_result_id.txt \
    -out \
    blastdbcmd_output.fasta
INFO [job step3_blastdbcmd] completed success
INFO [step step3_blastdbcmd] completed success
INFO [workflow ] starting step step4_clustalo
INFO [step step4_clustalo] start
INFO [job step4_clustalo] /tmp/0ch20d7y$ docker \
    run \
    -i \
    --mount=type=bind,source=/tmp/0ch20d7y,target=/XKQdXE \
    --mount=type=bind,source=/tmp/kj4ogriu,target=/tmp \
    --mount=type=bind,source=/tmp/qjene9aj/blastdbcmd_output.fasta,target=/var/lib/cwl/stgedb08f31-1999-4c21-9ea9-87f61c72e296/bla
stdbcmd_output.fasta,readonly \                                                                                                       --workdir=/XKQdXE \
    --read-only=true \
    --user=1000:1000 \
    --rm \
    --cidfile=/tmp/t3efhk2e/20230928045244-184118.cid \
    --env=TMPDIR=/tmp \
    --env=HOME=/XKQdXE \
    biocontainers/clustalo:v1.2.4-2-deb_cv1 \
    clustalo \
    -i \
    /var/lib/cwl/stgedb08f31-1999-4c21-9ea9-87f61c72e296/blastdbcmd_output.fasta \
    --outfmt \
    fasta \
    -o \
    clustalo_output.fasta
INFO [job step4_clustalo] completed success
INFO [step step4_clustalo] completed success
INFO [workflow ] starting step step5_fasttree
INFO [step step5_fasttree] start
INFO [job step5_fasttree] /tmp/8kehyeh7$ docker \
    run \
    -i \
    --mount=type=bind,source=/tmp/8kehyeh7,target=/XKQdXE \
    --mount=type=bind,source=/tmp/7u14_wey,target=/tmp \
    --mount=type=bind,source=/tmp/0ch20d7y/clustalo_output.fasta,target=/var/lib/cwl/stg358ccb55-655e-428a-b172-d4444da82abf/clust
alo_output.fasta,readonly \                                                                                                           --workdir=/XKQdXE \
    --read-only=true \
    --user=1000:1000 \
    --rm \
    --cidfile=/tmp/godhcg8g/20230928045245-203729.cid \
    --env=TMPDIR=/tmp \
    --env=HOME=/XKQdXE \
    biocontainers/fasttree:v2.1.10-2-deb_cv1 \
    fasttree \
    -out \
    fasttree_output.newick \
    /var/lib/cwl/stg358ccb55-655e-428a-b172-d4444da82abf/clustalo_output.fasta
FastTree Version 2.1.10 Double precision (No SSE3)
Alignment: /var/lib/cwl/stg358ccb55-655e-428a-b172-d4444da82abf/clustalo_output.fasta
Amino acid distances: BLOSUM45 Joins: balanced Support: SH-like 1000
Search: Normal +NNI +SPR (2 rounds range 10) +ML-NNI opt-each=1
TopHits: 1.00*sqrtN close=default refresh=0.80
ML Model: Jones-Taylor-Thorton, CAT approximation with 20 rate categories
Initial topology in 0.00 seconds
Refining topology: 15 rounds ME-NNIs, 2 rounds ME-SPRs, 7 rounds ML-NNIs
Total branch-length 0.205 after 0.01 sec
ML-NNI round 1: LogLk = -1664.746 NNIs 2 max delta 0.00 Time 0.12
      0.12 seconds: Site likelihoods with rate category 1 of 20
Switched to using 20 rate categories (CAT approximation)
Rate categories were divided by 0.677 so that average rate = 1.0
CAT-based log-likelihoods may not be comparable across runs
Use -gamma for approximate but comparable Gamma(20) log-likelihoods
ML-NNI round 2: LogLk = -1632.213 NNIs 0 max delta 0.00 Time 0.24
Turning off heuristics for final round of ML NNIs (converged)
      0.24 seconds: ML NNI round 3 of 7, 1 of 11 splits
ML-NNI round 3: LogLk = -1632.213 NNIs 0 max delta 0.00 Time 0.33 (final)
Optimize all lengths: LogLk = -1632.213 Time 0.35
Total time: 0.44 seconds Unique: 13/20 Bad splits: 0/10
INFO [job step5_fasttree] Max memory used: 0MiB
INFO [job step5_fasttree] completed success
INFO [step step5_fasttree] completed success
INFO [workflow ] completed success
{
    "final_output_bootstrap": {
        "location": "file:///workspaces/togotv_shooting/fasttree_output.newick",
        "basename": "fasttree_output.newick",
        "class": "File",
        "checksum": "sha1$2174533dd0b0da12a274ed2e0849f7c878c9376b",
        "size": 807,
        "path": "/workspaces/togotv_shooting/fasttree_output.newick"
    }
}INFO Final process status is success
```

è§£æžãŒæˆåŠŸã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ï½¡ å®Ÿéš›ã«ï½¤newickå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ï½¡ ã“ã®ã‚ˆã†ã«ï½¤ä½•å›žã‚‚ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã›ãšï½¤1ã¤ã®ã‚³ãƒžãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï½¡
__CWLã§è¨˜è¿°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯æ§˜ã€…ãªç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã®ã§ï½¤ãœã²ã”è‡ªèº«ã§ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ç¢ºã‹ã‚ã¦ãã ã•ã„!__

&nbsp;

:::danger
# è¿½è¨˜ï¼šãƒªãƒ³ã‚¯é›†ã‚’ä½œæˆã™ã‚‹

1. ä½œã£ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒªãƒã‚¸ãƒˆãƒª
:::


